<html>
  <head>
    <title>Flowty Wrapped 2023</title>
    <link
      rel="icon"
      href="https://flowty.mypinata.cloud/ipfs/QmctZJrzKu3ctyFLeZZAS2FkU6uLKMZNUkZbY24H2wjFzJ/favicon.ico"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900"
      rel="stylesheet"
    />
    <style>
      html {
        background: #031021;
      }
      body {
        width: 100%;
        height: 100vh;
        color: #fff;
        font-family: "Montserrat", Courier, monospace;
        font-size: 16px;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .sky {
        color: #fff;
      }

      .wrapped-div {
        width: 1390px;
        height: 750px;
        background-image: url(./bgNoSnow.jpg);
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        display: flex;
      }

      .card {
        display: none;
        width: 350px;
        height: 470px;
        perspective: 1500px;
        position: absolute;
        left: calc(50% - 350px / 2);
        top: calc(50% - 500px / 2);
        transition-property: transform;
        transition-duration: 1s;
        transition-timing-function: ease-in-out;
        transition-delay: initial;
        transform: rotate(-10deg) translate(0, 0);
        animation: cardIn 1s alternate cubic-bezier(0.87, -0.41, 0.19, 1.44);
        z-index: 10;
      }

      .card:before {
        content: "";
        display: block;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        box-shadow: 0 0 50px #000;
        transition: all 0.5s ease-in-out;
      }

      .is-opened {
        transform: rotate(0deg) translate(calc(350px / 2), 0);
      }

      .is-opened-card-page-front {
        transform: rotateY(-180deg) !important;
      }

      .card-page-front {
        transform-origin: 0 50% 0;
        transform-style: preserve-3d;
        transform: rotateY(-20deg);
        z-index: 2;
      }

      @keyframes cardIn {
        0% {
          opacity: 0;
          transform: rotate(-10deg) translate(0, -100%);
        }
        25% {
          opacity: 1;
        }
        100% {
          opacity: 1;
          transform: rotate(-10deg) translate(0, 0);
        }
      }

      .card-page {
        width: 350px;
        height: 470px;
        transition: transform 1s ease-in-out;
        cursor: pointer;
        position: absolute;
        outline: 1px solid transparent;
      }

      .cart-page-front {
        transform-origin: 0 50% 0;
        transform-style: preserve-3d;
        transform: rotateY(-20deg);
        z-index: 2;
      }

      .cart-page-outside {
        background-size: contain;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .cart-page-inside {
        transform: rotateY(-180deg);
        border-right: none !important;
        background-position: 0px 80px;
        background-size: contain;
        background-position: center;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
      }

      .cart-page-bottom {
        z-index: 1;
        border-left: none !important;
        background-position: -22px 80px;
        background-size: contain;
        background-position: center;
        width: 100%;
        height: 100%;
      }

      .click-icon {
        width: 100px;
        height: 100px;
        position: absolute;
        left: 50%;
        transform: translate(-50%, 0);
        bottom: -90px;
        z-index: 10;
        animation: iconAnimation 1s infinite alternate;
        transition: opacity 0.5s;
        opacity: 50%;
      }

      .is-hidden {
        opacity: 0;
      }

      @keyframes iconAnimation {
        0% {
          transform: translate(-50%, 0);
        }
        100% {
          transform: translate(-50%, 10px);
        }
      }

      .card-content {
        padding: 30px;
        margin-top: 15px;
        display: flex;
        flex-direction: column;
      }

      .nice-naughty-box {
        display: flex;
        flex-direction: column;
        padding: 12px;
        gap: 8px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.24);
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(25px);
      }

      .is-naughty-svg {
        position: absolute;
        top: -5px;
        left: 48px;
      }

      .is-nice-svg {
        position: absolute;
        top: -5px;
        left: -11px;
      }

      @supports (-webkit-backdrop-filter: blur(1px)) {
        .is-naughty-svg {
          position: absolute;
          top: 88px;
          left: 82px;
        }

        .is-nice-svg {
          position: absolute;
          top: 88px;
          left: 27px;
        }
      }
    </style>
  </head>
  <body class="sky">
    <div class="wrapped-div"></div>
    <div class="card" id="card">
      <div class="card-page cart-page-front" id="card-front">
        <div class="card-page cart-page-outside">
          <p
            style="
              padding-left: 10px;
              padding-top: 18px;
              font-size: 12px;
              font-weight: 900;
              color: #04e5a3;
              opacity: 70%;
            "
            id="raffleTickets-tag-1"
          ></p>
          <p
            style="
              text-align: right;
              padding-right: 10px;
              font-size: 12px;
              font-weight: 900;
              color: #04e5a3;
              opacity: 70%;
            "
            id="username-tag-1"
          ></p>
        </div>
        <div class="card-page cart-page-inside"></div>
      </div>
      <div class="card-page cart-page-bottom">
        <div class="card-content">
          <p>Dear <span id="username-tag" style="font-weight: 700"></span>,</p>
          <div class="nice-naughty-box">
            <div style="display: flex; gap: 4px; font-size: 12px">
              <span>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="72"
                  height="49"
                  viewBox="0 0 72 49"
                  fill="none"
                  id="is-nice"
                  class="is-nice-svg"
                >
                  <path
                    d="M6.74077 40.3286C16.3123 53.2046 69.2007 31.0665 67.9401 17.0724C65.9534 -4.98135 16.5333 10.314 11.2642 19.1177C11.0691 19.4437 11.2386 19.904 11.4319 19.7435C28.3405 5.6993 64.9722 1.89313 65.9898 17.595C65.6002 29.8684 11.5494 53.0572 7.13276 37.4859C4.22473 27.2333 26.8008 10.7933 45.8395 9.00454C46.3498 8.73091 45.7715 8.2873 45.1427 8.32887C24.7313 10.2628 -1.25235 27.7387 6.74077 40.3286Z"
                    fill="#04E5A3"
                  />
                </svg>
                Nice</span
              >
              <span>or</span>
              <div>
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="72"
                  height="49"
                  viewBox="0 0 72 49"
                  fill="none"
                  id="is-naughty"
                  class="is-naughty-svg"
                >
                  <path
                    d="M6.74077 40.3286C16.3123 53.2046 69.2007 31.0665 67.9401 17.0724C65.9534 -4.98135 16.5333 10.314 11.2642 19.1177C11.0691 19.4437 11.2386 19.904 11.4319 19.7435C28.3405 5.6993 64.9722 1.89313 65.9898 17.595C65.6002 29.8684 11.5494 53.0572 7.13276 37.4859C4.22473 27.2333 26.8008 10.7933 45.8395 9.00454C46.3498 8.73091 45.7715 8.2873 45.1427 8.32887C24.7313 10.2628 -1.25235 27.7387 6.74077 40.3286Z"
                    fill="#FF0000"
                  />
                </svg>
                <span>Naughty</span>
              </div>
            </div>
            <p style="font-size: 12px; line-height: 0px">
              Flowty Wrapped Raffle Tickets:
              <span style="font-weight: 700" id="raffleTickets-tag"></span>
            </p>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 8px;
              margin-top: 20px;
              font-size: 14px;
              font-weight: 400;
              text-align: left;
            "
          >
            <p style="margin: 0px">
              You are on the
              <span id="nice-naughty-tag" style="font-weight: 700"></span> list
              this year! Based on your Flowty activity, you will have
              <span id="raffleTickets-tag-2" style="font-weight: 700"></span>
              raffle tickets.
            </p>
            <p style="margin: 0px">
              Raffle prizes include
              <span style="font-weight: 900; text-decoration: underline"
                >5,000+ FLOW Tokens</span
              >, NFTs from your favorite collections and much more!
            </p>
            <p style="margin: 0px">
              For information and winner announcements, follow along at
              @flowty_io (Twitter) or join our discord!
            </p>
            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 3px;
                margin-top: 5px;
              "
            >
              <p style="text-align: left; margin: 0px">Happy Holidays!</p>
              <p style="text-align: left; margin: 0px">- The Flowty Team</p>
            </div>
          </div>
        </div>
      </div>
      <span class="click-icon">
        <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
          <path
            fill="#fff"
            d="M31.6 17.7V26c0 1.9-.7 3.7-2 5.1v.9c0 1.6-1.3 3-3 3h-8.4c-1.6 0-3-1.3-3-3 0-.6.5-1 1-1s1 .4 1 1c0 .5.4 1 1 1h8.4c.5 0 1-.4 1-1v-1.2-.3-.1c0-.1.1-.2.2-.3 1.1-1.1 1.7-2.5 1.7-4v-8.3c0-.3-.1-.5-.3-.7-.1-.1-.5-.4-1-.3-.4.1-.8.6-.8 1.1v2.4c0 .6-.5 1-1 1s-1-.4-1-1v-5.5c0-.3-.1-.5-.3-.7s-.4-.3-.7-.3c-.5 0-1 .5-1 1v5.5c0 .6-.5 1-1 1s-1-.4-1-1v-8.5c0-.3-.1-.5-.3-.7s-.4-.3-.7-.3c-.5 0-1 .5-1 1v8.5c0 .6-.5 1-1 1s-1-.4-1-1V7.7c0-.3-.1-.5-.3-.7-.1-.1-.5-.4-1-.3-.4.1-.8.6-.8 1.1V20c0 .4-.2.8-.6.9-.4.2-.8.1-1.1-.2L11 18.1c-.6-.6-1.6-.6-2.2.1-.5.6-.4 1.5.2 2.1l7 7c.4.4.4 1 0 1.4-.2.2-.5.3-.7.3-.3 0-.5-.1-.7-.3l-7-7.1c-1.3-1.3-1.5-3.5-.3-4.8C8 16 9 15.5 10 15.5c.9 0 1.8.4 2.5 1l.9.9V7.9c0-1.4.9-2.7 2.3-3 1-.3 2.1 0 2.8.8.6.6.9 1.3.9 2.1V9c.3-.1.7-.2 1-.2.8 0 1.5.3 2.1.9s.9 1.3.9 2.1v.2c.3-.1.7-.2 1-.2.8 0 1.5.3 2.1.9s.9 1.3.9 2.1v.2c.1 0 .2-.1.3-.1 1-.3 2.1 0 2.8.8.8.5 1.1 1.3 1.1 2z"
          />
        </svg>
      </span>
    </div>
  </body>
  <script>
    let username;
    let raffleTickets;

    window.addEventListener("load", async () => {
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      let ipfsURL = "https://flowty.mypinata.cloud/ipfs/";

      username = urlParams.get("username");
      raffleTickets = urlParams.get("raffleTickets");
      customProvider = urlParams.get("customIpfsProvider");

      if (customProvider) {
        ipfsURL = customProvider;
      }

      const bgNoSnow =
        ipfsURL + "QmctZJrzKu3ctyFLeZZAS2FkU6uLKMZNUkZbY24H2wjFzJ/bgNoSnow.jpg";
      // const wrappedBg = document.querySelector(".wrapped-div");
      // wrappedBg.style.backgroundImage = `url(${bgNoSnow})`;

      const cardInsideLeft =
        ipfsURL +
        "QmctZJrzKu3ctyFLeZZAS2FkU6uLKMZNUkZbY24H2wjFzJ/cardInsideLeft.png";
      // const cartPageInside = document.querySelector(".cart-page-inside");
      // cartPageInside.style.backgroundImage = `url(${cardInsideLeft})`;

      const cardInsideRight =
        ipfsURL +
        "QmctZJrzKu3ctyFLeZZAS2FkU6uLKMZNUkZbY24H2wjFzJ/cardRightSide.png";
      // const cartPageBottom = document.querySelector(".cart-page-bottom");
      // cartPageBottom.style.backgroundImage = `url(${cardInsideRight})`;

      const wrappedCard =
        ipfsURL +
        "QmctZJrzKu3ctyFLeZZAS2FkU6uLKMZNUkZbY24H2wjFzJ/wrappedCard.png";
      // const cartPageOutside = document.querySelector(".cart-page-outside");
      // cartPageOutside.style.backgroundImage = `url(${wrappedCard})`;

      function loadImage(url) {
        return new Promise((resolve, reject) => {
          const img = new Image();
          img.onload = resolve;
          img.onerror = reject;
          img.src = url;
        });
      }

      Promise.all([
        loadImage(bgNoSnow),
        loadImage(cardInsideLeft),
        loadImage(cardInsideRight),
        loadImage(wrappedCard),
      ])
        .then(() => {
          const wrappedBg = document.querySelector(".wrapped-div");
          wrappedBg.style.backgroundImage = `url(${bgNoSnow})`;

          const cartPageInside = document.querySelector(".cart-page-inside");
          cartPageInside.style.backgroundImage = `url(${cardInsideLeft})`;

          const cartPageBottom = document.querySelector(".cart-page-bottom");
          cartPageBottom.style.backgroundImage = `url(${cardInsideRight})`;

          const cartPageOutside = document.querySelector(".cart-page-outside");
          cartPageOutside.style.backgroundImage = `url(${wrappedCard})`;

          setTimeout(() => {
            const card = document.querySelector(".card");
            if (card) {
              card.style.display = "block";
            }
          }, 500);
        })
        .catch((err) => {
          console.log("loading image error", err);
        });

      const usernameTag = document.getElementById("username-tag");
      const usernameTag1 = document.getElementById("username-tag-1");
      const raffleTicketsTag = document.getElementById("raffleTickets-tag");
      const raffleTicketsTag1 = document.getElementById("raffleTickets-tag-1");
      const raffleTicketsTag2 = document.getElementById("raffleTickets-tag-2");
      const niceNaughtyTag = document.getElementById("nice-naughty-tag");

      if (raffleTickets > 0) {
        document.getElementById("is-naughty").style.display = "none";
        niceNaughtyTag.innerText = "NICE";
      } else {
        document.getElementById("is-nice").style.display = "none";
        niceNaughtyTag.innerText = "NAUGHTY";
      }

      if (username) {
        usernameTag.innerText = `${username}`;
        usernameTag1.innerText = `${username}`;
      } else {
        usernameTag.innerText = `Flowty User`;
        usernameTag1.innerText = `Flowty User`;
      }

      if (raffleTickets) {
        raffleTicketsTag.innerText = `${raffleTickets}`;
        raffleTicketsTag1.innerText = `${raffleTickets} RAFFLE TICKETS`;
        raffleTicketsTag2.innerText = `[${raffleTickets}]`;
      } else {
        raffleTicketsTag.innerText = `0`;
        raffleTicketsTag1.innerText = `0 RAFFLE TICKETS`;
        raffleTicketsTag2.innerText = `[0]`;
      }
    });

    (function () {
      var COUNT = 300;
      var masthead = document.querySelector(".sky");
      var canvas = document.createElement("canvas");
      var ctx = canvas.getContext("2d");
      var width = masthead.clientWidth;
      var height = masthead.clientHeight;
      var i = 0;
      var active = false;

      function onResize() {
        width = masthead.clientWidth;
        height = masthead.clientHeight;
        canvas.width = width;
        canvas.height = height;
        canvas.style.width = "100%";
        ctx.fillStyle = "#FFF";

        var wasActive = active;
        active = width > 100;

        if (!wasActive && active) requestAnimFrame(update);
      }

      var Snowflake = function () {
        this.x = 0;
        this.y = 0;
        this.vy = 0;
        this.vx = 0;
        this.r = 0;

        this.reset();
      };

      Snowflake.prototype.reset = function () {
        this.x = Math.random() * width;
        this.y = Math.random() * -height;
        this.vy = 1 + Math.random() * 3;
        this.vx = 0.5 - Math.random();
        this.r = 1 + Math.random() * 2;
        this.o = 0.5 + Math.random() * 0.5;
      };

      canvas.style.position = "absolute";
      canvas.style.left = canvas.style.top = "0";

      var snowflakes = [],
        snowflake;
      for (i = 0; i < COUNT; i++) {
        snowflake = new Snowflake();
        snowflake.reset();
        snowflakes.push(snowflake);
      }

      function update() {
        ctx.clearRect(0, 0, width, height);

        if (!active) return;

        for (i = 0; i < COUNT; i++) {
          snowflake = snowflakes[i];
          snowflake.y += snowflake.vy;
          snowflake.x += snowflake.vx;

          ctx.globalAlpha = snowflake.o;
          ctx.beginPath();
          ctx.arc(snowflake.x, snowflake.y, snowflake.r, 0, Math.PI * 2, false);
          ctx.closePath();
          ctx.fill();

          if (snowflake.y > height) {
            snowflake.reset();
          }
        }

        requestAnimFrame(update);
      }

      window.requestAnimFrame = (function () {
        return (
          window.requestAnimationFrame ||
          window.webkitRequestAnimationFrame ||
          window.mozRequestAnimationFrame ||
          function (callback) {
            window.setTimeout(callback, 1000 / 60);
          }
        );
      })();

      onResize();
      window.addEventListener("resize", onResize, false);

      masthead.appendChild(canvas);
    })();

    document.addEventListener("DOMContentLoaded", function () {
      var clickMe = document.getElementsByClassName("click-icon")[0];
      var card = document.getElementById("card");
      var cardFront = document.getElementById("card-front");

      card.addEventListener("click", function () {
        card.classList.toggle("is-opened");
        cardFront.classList.toggle("is-opened-card-page-front");
        clickMe.classList.toggle("is-hidden");
      });
    });
  </script>
</html>
